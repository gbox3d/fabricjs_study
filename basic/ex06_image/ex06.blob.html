<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title> fabrics image </title>
    <script src="../node_modules/fabric/dist/fabric.js"></script>

    <style>
        .hide {
            display: none;
        }
    </style>
</head>

<body>

    <canvas id="main-canvas" width="512" height="512"></canvas>

    <script type="module">

        const fbCanvas = new fabric.Canvas('main-canvas', {
            backgroundColor: '#000',
            enableRetinaScaling: false //레티나 비활성화
        })
        fbCanvas.viewportTransform = fabric.util.composeMatrix({ translateX: 256, translateY: 256})

        document.addEventListener('keydown', async (evt) => {
            console.log(evt)
            switch(evt.key) {
                case 'q': //정점 정보 리스팅
                {
                    let resp = await fetch("http://ubiqos001.iptime.org:21030/api/v2/webdisk/readFile", {
                        method : 'POST',
                        body : ['/home/gbox3d/work/dataset/fruts_nuts/images','0.jpg'].join('\n'),
                        //body : '/home/gbox3d/work/dataset/fruts_nuts',
                        headers: new Headers({
                            "Content-Type": 'application/text'
                        })
                    })
        
                    console.log(resp)
                    if(resp.ok) {
                        
                        let  responseAsBlob = await resp.blob() //바이너리 원본데이터얻기 
                        let imgUrl = URL.createObjectURL(responseAsBlob); //url 객체로 변환
                        
                        fabric.Image.fromURL(imgUrl, ((object) => {
                            console.log(object);

                            //원점 으로 위치변환 
                            fabric.util.applyTransformToObject(object,fabric.util.composeMatrix({}))
                            object.setCoords();

                            fbCanvas.add(object);
                          }));
                    }

                }
                break;
            }
        })
        {
            fbCanvas.add(new fabric.Line([-256,0,256,0], {
                //fill: 'red',
                stroke: '#0f0',
                strokeWidth: 2,
                selectable: false,
                evented: false,
              }));
              fbCanvas.add(new fabric.Line([0,-256,0,256], {
                //fill: 'red',
                stroke: '#0f0',
                strokeWidth: 2,
                selectable: false,
                evented: false,
              }))
        }


    </script>




</body>

</html>